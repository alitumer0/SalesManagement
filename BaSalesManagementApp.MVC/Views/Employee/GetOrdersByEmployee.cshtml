@using BaSalesManagementApp.MVC.Models.EmployeeVMs
@model EmployeeOrderVM

@{
    ViewData["Title"] = "Orders by Employee";
}


@if (Model.Orders == null || !Model.Orders.Any())
{
    <p>@localizer["No orders found for this employee"].</p>
}
else
{
    <h3 class="text-center my-4">@localizer["Daily Order Summary"]</h3>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>@localizer["OrderDate"]</th>
                <th>@localizer["Total Orders"]</th>
                <th>@localizer["Total Daily Price"]</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var summary in Model.DailyOrderSummary.OrderByDescending(s => s.OrderDate)) // Tarihe göre sıralama
            {
                <tr>
                    <td>@summary.OrderDate.ToString("dd.MM.yyyy")</td>
                    <td>@summary.TotalOrders</td>
                    <td>@summary.TotalDailyPrice.ToString("C", new System.Globalization.CultureInfo("tr-TR"))</td>
                </tr>
            }
        </tbody>
    </table>
    <h3 class="text-center my-4">@localizer["OrderDetails"]</h3>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>@localizer["OrderDate"]</th>
                <th>@localizer["TotalPrice"]</th>
                <th>@localizer["Is Active"]</th>
                <th>@localizer["Details"]</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var order in Model.Orders.OrderByDescending(o => o.OrderDate)) // Tarihe göre sıralama
            {
                <tr>
                    <td>@order.OrderDate.ToString("dd.MM.yyyy")</td>
                    <td>@order.TotalPrice.ToString("C", new System.Globalization.CultureInfo("tr-TR"))</td>
                    <td>@(order.IsActive ? localizer["Active"] : localizer["Inactive"])</td>
                    <td>
                        <button class="btn btn-info toggle-details" data-target="#details-@order.Id">
                            @localizer["Details"]
                        </button>
                    </td>
                </tr>
                <tr id="details-@order.Id" class="details-row" style="display: none;">
                    <td colspan="4">
                        <h5>@localizer["OrderDetails"]</h5>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>@localizer["Product Name"]</th>
                                    <th>@localizer["Quantity"]</th>
                                    <th>@localizer["Unit Price"]</th>
                                    <th>@localizer["Discount (%)"]</th>
                                    <th>@localizer["Discounted Total Price"]</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var detail in order.OrderDetails)
                                {
                                    <tr>
                                        <td>@detail.ProductName</td>
                                        <td>@detail.Quantity</td>
                                        <td>@detail.UnitPrice.ToString("C", new System.Globalization.CultureInfo("tr-TR"))</td>
                                        <td>
                                            @(detail.Discount > 0 ? $"{detail.Discount}%" : localizer["No Discount"])
                                        </td>
                                        <td>
                                            @((detail.UnitPrice * detail.Quantity * (1 - detail.Discount / 100))
                                                .ToString("C", new System.Globalization.CultureInfo("tr-TR")))
                                        </td>

                                    </tr>
                                }
                            </tbody>
                        </table>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
@* <div class="d-flex justify-content-end align-items-center mb-4">
    <a asp-action="Index" class="btn btn-secondary">@localizer["BackToList"]</a>
</div> *@

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".toggle-details").forEach(function (button) {
                button.addEventListener("click", function () {
                    var targetId = this.getAttribute("data-target");
                    var targetRow = document.querySelector(targetId);

                    if (targetRow) {
                        if (targetRow.style.display === "none") {
                            targetRow.style.display = "table-row";
                            this.textContent = "@localizer["Hide"]";
                        } else {
                            targetRow.style.display = "none";
                            this.textContent = "@localizer["Details"]";
                        }
                    }
                });
            });
        });
    </script>
}